SET SCHEMA BOOKS1;

DROP TABLE BOOKS1.USERS_BOOKS;
DROP TABLE BOOKS1.READING_STATUS;
DROP TABLE BOOKS1.BOOKS;
DROP TABLE BOOKS1.USERS;

CREATE TABLE BOOKS1.USERS (
	id INT 
		GENERATED BY DEFAULT AS IDENTITY 
		PRIMARY KEY,
	email VARCHAR(50) NOT NULL,
	name VARCHAR(100) NOT NULL,
	password_hash VARCHAR(100) NOT NULL,
	created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT books1.u_users_email UNIQUE (email)
);

CREATE TABLE BOOKS1.BOOKS (
	id INT 
		GENERATED BY DEFAULT AS IDENTITY 
		PRIMARY KEY,
	title VARCHAR(100) NOT NULL,
	author VARCHAR(100),
	isbn10 VARCHAR(10),
	created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	created_by INT,
	updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	updated_by INT,
	CONSTRAINT books1.fk_books_users1 FOREIGN KEY (created_by) REFERENCES books1.users (id),
	CONSTRAINT books1.fk_books_users2 FOREIGN KEY (updated_by) REFERENCES books1.users (id)
);

CREATE TABLE BOOKS1.READING_STATUS (
	id INT NOT NULL PRIMARY KEY,
	name VARCHAR(50) NOT NULL,
	CONSTRAINT books1.u_reading_status_name UNIQUE (name)
);

INSERT INTO READING_STATUS
VALUES (1, 'WANT_TO_READ'),
	   (2, 'READING'),
	   (3, 'COMPLETED'),
	   (4, 'ABANDONED');

CREATE TABLE BOOKS1.USERS_BOOKS (
	user_id INT NOT NULL,
	book_id INT NOT NULL,
	reading_status_id INT NOT NULL,
	CONSTRAINT books1.fk_users_books_users FOREIGN KEY (user_id) REFERENCES books1.users (id),
	CONSTRAINT books1.fk_users_books_books FOREIGN KEY (book_id) REFERENCES books1.books (id),
	CONSTRAINT books1.fk_users_books_reading_status FOREIGN KEY (reading_status_id) REFERENCES books1.reading_status (id)
);
